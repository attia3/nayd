% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/R_08_run_disagg_clustering.R
\name{run_disagg_clustering_batch}
\alias{run_disagg_clustering_batch}
\title{Run NAYD disaggregation and clustering for multiple counties and years}
\usage{
run_disagg_clustering_batch(
  years,
  counties,
  nass_table,
  counties_sf,
  crop_name,
  sensor = "LANDSAT",
  betas = c(0.8, 1, 1.2, 1.4, 1.6, 1.8),
  cluster_dist_m = 10000,
  max_field_ha_thresh = 300,
  tile_target_ha = 200,
  min_field_ha = 5,
  max_field_ha_final = 500,
  min_frac = NULL,
  max_frac = NULL,
  y_min_crop = NULL,
  y_max_crop = NULL,
  min_abs = NULL
)
}
\arguments{
\item{years}{Integer vector of years to process.}

\item{counties}{Character vector of county names (as they appear in
\code{counties_sf$COUNTY}).}

\item{nass_table}{A data frame with at least the columns
\code{county}, \code{year}, \code{area_harvested_ha}, and \code{yield_kg_ha}. County names
should already be normalised in the same way used when creating the
weight rasters.}

\item{counties_sf}{An \code{sf} object with county polygons and a \code{COUNTY}
column matching the (unnormalised) county names used in \code{counties}.}

\item{crop_name}{Character crop label used when constructing cache paths
(e.g., \code{"winter wheat"}, \code{"cotton"}).}

\item{sensor}{Character sensor tag used when constructing cache paths
(e.g., \code{"LANDSAT"}).}

\item{betas}{Numeric vector of beta exponents to evaluate.}

\item{cluster_dist_m}{Maximum complete-linkage distance (in metres) used
when clustering units into production zones.}

\item{max_field_ha_thresh, tile_target_ha, min_field_ha, max_field_ha_final}{Segmentation and tiling parameters passed on to \code{segment_fields_diag()}.}

\item{min_frac, max_frac}{Optional relative yield bounds passed through to
\code{disagg_units_yield_safe()}. Use \code{NULL} to rely purely on crop-specific
caps.}

\item{y_min_crop, y_max_crop, min_abs}{Optional crop-specific caps passed to
\code{disagg_units_yield_safe()}. If \code{NULL}, defaults are chosen internally
based on the crop.}
}
\value{
A tibble with one row per cluster–county–year–beta combination,
containing cluster centroid coordinates, area, production, yield, and the
corresponding NASS reference area and yield.
}
\description{
This is a high-level batch wrapper around \code{process_county_year()} that:
\enumerate{
\item reads cached weight rasters for each county–year,
\item segments harvest units and disaggregates NASS yields,
\item clusters units into production zones,
\item returns a stacked table of cluster-level yields.
}
}
\details{
It assumes that weight rasters have already been created by
\code{get_weights_for_county_year()} and written via
\code{.cache_path("weight", ...)}.
}
